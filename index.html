<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>KOSMOS.ARCADE ‚Äî Worm & Cat</title>
<meta name="theme-color" content="#0b1020">
<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ====== –ë–ê–ó–ê/UI ====== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Inter',system-ui,Arial;background:#0b1020;color:#fff;overflow:hidden}
.bg{position:fixed;inset:0;background:
  radial-gradient(1200px 600px at 20% 0%,#1b1f3d 0%,transparent 55%),
  radial-gradient(1200px 600px at 80% 100%,#13233a 0%,transparent 55%);z-index:-2}
.top{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:rgba(0,0,0,.35);
     border-bottom:1px solid rgba(255,255,255,.1);backdrop-filter:blur(10px)}
.brand{display:flex;gap:8px;align-items:center;font-family:'Russo One',sans-serif;font-size:20px;letter-spacing:1px}
.brand em{color:#39f3ff;font-style:normal}
.actions{display:flex;gap:8px;align-items:center}
.chip{padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);color:#fff}
.btn{cursor:pointer;transition:transform .1s, background .2s}
.btn:hover{background:rgba(255,255,255,.12)}
.btn:active{transform:scale(.96)}
.input{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:#fff}

.main{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:18px}
.h1{font-family:'Russo One',sans-serif;font-size:clamp(26px,5.5vw,54px);text-shadow:0 0 8px #39f3ff,0 0 18px #39f3ff}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.label{opacity:.7;font-size:14px}

.cards{display:grid;gap:18px;grid-template-columns:repeat(2,minmax(260px,1fr))}
@media(max-width:820px){.cards{grid-template-columns:1fr}}
.card{overflow:hidden;border-radius:16px;background:linear-gradient(145deg,#151c3a,#0a0f20);
  border:1px solid rgba(255,255,255,.10);box-shadow:0 10px 30px #00000055,inset 0 0 0 1px #ffffff08;
  transition:transform .18s ease,box-shadow .2s ease}
.card:hover{transform:translateY(-2px);box-shadow:0 16px 40px #00000070,inset 0 0 0 1px #ffffff10}
.card__media{aspect-ratio:16/9;background:#0d1326;display:flex;align-items:center;justify-content:center;font-size:28px;opacity:.85}
.card__title{font:700 20px/1.1 'Russo One',sans-serif;letter-spacing:.5px;margin:10px 14px 4px}
.card__desc{color:#cbd3ff99;font-size:14px;line-height:1.45;margin:0 14px 12px}
.btn--play{width:calc(100% - 28px);margin:0 14px 16px;padding:12px;border-radius:10px;border:1px solid #2bf0ff66;
  background:linear-gradient(180deg,#27c8ff26,#1b2c46);box-shadow:0 0 16px #27c8ff40 inset,0 0 18px #27c8ff25}

.footer{padding:10px 0;text-align:center;color:#9aa1b6;border-top:1px solid rgba(255,255,255,.1)}

/* ====== HUD WORM ====== */
.hud-worm{position:fixed;inset:0;pointer-events:none;z-index:60;display:none}
.hud-worm.show{display:block}
.hud__btn{position:absolute;pointer-events:auto;border:none;border-radius:999px;background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);color:#fff}
.hud__boost{right:14px;bottom:16px;width:74px;height:74px;font-size:20px}
.hud__ghost{left:14px;bottom:16px;width:74px;height:74px;font-size:20px}

/* ====== HUD CAT ====== */
.hud-cat{position:fixed;inset:0;pointer-events:none;z-index:60;display:none}
.hud-cat.show{display:block}
.cat-btn{position:absolute;pointer-events:auto;border:none;border-radius:999px;background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);color:#fff;width:74px;height:74px;font-size:22px}
.cat-left{left:14px;bottom:16px}.cat-right{right:14px;bottom:16px}

/* ====== –†–µ–∫–æ—Ä–¥—ã ====== */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none;z-index:80;
  align-items:center;justify-content:center;padding:20px}
.modal.show{display:flex}
.modal__box{width:min(620px,92vw);max-height:80vh;overflow:auto;background:#0e152d;border:1px solid #ffffff22;border-radius:14px;box-shadow:0 18px 60px #0008}
.modal__head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #ffffff1a}
.modal__title{font:700 18px 'Russo One',sans-serif}
.modal__body{padding:12px 14px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px 10px;border-bottom:1px solid #ffffff12;text-align:left}
.table th{opacity:.75;font-weight:600}

/* ====== –°–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∏–≥—Ä–µ ====== */
body.playing-worm .top,body.playing-worm .main,body.playing-worm .footer{display:none}
body.playing-cat  .top,body.playing-cat  .main,body.playing-cat  .footer{display:none}
</style>
</head>
<body>
<div class="bg"></div>

<header class="top">
  <div class="brand">‚ú¶ <span>KOSMOS.<em>ARCADE</em></span></div>
  <div class="actions">
    <span class="label">–ò–º—è:</span>
    <input class="input" id="player-name" value="Kosmos" maxlength="16" style="width:140px">
    <span class="label">–ë–æ—Ç–æ–≤:</span>
    <input class="input" id="bot-count" type="number" min="0" max="24" value="10" style="width:70px">
    <div class="chip" id="score-chip">0</div>
    <button class="chip btn" id="btn-records">–†–µ–∫–æ—Ä–¥—ã</button>
    <button class="chip btn" id="btn-menu">–í –º–µ–Ω—é</button>
  </div>
</header>

<main class="main">
  <h1 class="h1">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º</h1>

  <div class="row" style="gap:14px">
    <span class="label">–ö–∞—Ä—Ç–∞ –±–æ–ª—å—à–∞—è, –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º. –ï–¥–∞ –¥–∞—ë—Ç –æ—á–∫–∏ –∏ —Ä–æ—Å—Ç. –£ –∑–º–µ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –Ω–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ (—Å–≤–∞–π–ø), –µ—Å—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏–µ.</span>
  </div>

  <section class="cards">
    <article class="card">
      <div class="card__media">üêç</div>
      <h3 class="card__title">Worm</h3>
      <p class="card__desc">–ó–º–µ–π–∫–∞ –≤ —Å—Ç–∏–ª–µ wormax.io: —Å–≤–µ—Ç—è—â–µ–µ—Å—è —Ç–µ–ª–æ —Å –≥–ª–∞–∑–∫–∞–º–∏, –±–æ—Ç—ã-–ø–ª–∞–Ω–µ—Ç—ã, –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –±–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–∞.</p>
      <button class="btn btn--play" id="play-worm">–ò–≥—Ä–∞—Ç—å</button>
    </article>

    <article class="card">
      <div class="card__media">üê±</div>
      <h3 class="card__title">Cat (Jump)</h3>
      <p class="card__desc">–ö–æ—Ç –≤ —Å–∫–∞—Ñ–∞–Ω–¥—Ä–µ –ø—Ä—ã–≥–∞–µ—Ç –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º –≤–≤–µ—Ä—Ö, –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏/–∫–Ω–æ–ø–∫–∞–º–∏.</p>
      <button class="btn btn--play" id="play-cat">–ò–≥—Ä–∞—Ç—å</button>
    </article>
  </section>
</main>

<footer class="footer">made by kosmos.bud 2k25</footer>

<!-- HUD WORM -->
<div class="hud-worm" id="worm-hud">
  <button class="hud__btn hud__ghost" id="btn-ghost" title="–ù–µ–≤–∏–¥–∏–º–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω–∞—è)">üëª</button>
  <button class="hud__btn hud__boost" id="btn-boost" title="–£—Å–∫–æ—Ä–µ–Ω–∏–µ">‚ö°</button>
</div>

<!-- HUD CAT -->
<div class="hud-cat" id="cat-hud">
  <button class="cat-btn cat-left"  id="cat-left">‚óÄ</button>
  <button class="cat-btn cat-right" id="cat-right">‚ñ∂</button>
</div>

<!-- MODAL RECORDS -->
<div class="modal" id="modal">
  <div class="modal__box">
    <div class="modal__head">
      <div class="modal__title">–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</div>
      <button class="chip btn" id="close-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="modal__body">
      <h4 style="margin:0 0 6px">Worm</h4>
      <table class="table" id="table-worm"><thead><tr><th>#</th><th>–ò–º—è</th><th>–û—á–∫–∏</th></tr></thead><tbody></tbody></table>
      <h4 style="margin:12px 0 6px">Cat</h4>
      <table class="table" id="table-cat"><thead><tr><th>#</th><th>–ò–º—è</th><th>–û—á–∫–∏</th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</div>

<script>
/* ============== –£–¢–ò–õ–ò–¢–´ + –†–ï–ö–û–†–î–´ (LocalStorage) ============== */
const $$  = sel => document.querySelector(sel);
const on  = (el,ev,fn,opt)=>el&&el.addEventListener(ev,fn,opt);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const rand =(a,b)=>a+Math.random()*(b-a);

const REC_KEY_WORM='kosmos_records_worm';
const REC_KEY_CAT ='kosmos_records_cat';
function pushRecord(key, name, score, limit=10){
  const arr = JSON.parse(localStorage.getItem(key)||'[]');
  arr.push({name,score,ts:Date.now()});
  arr.sort((a,b)=>b.score-a.score);
  localStorage.setItem(key, JSON.stringify(arr.slice(0,limit)));
}
function fillTable(key, tbody){
  const arr = JSON.parse(localStorage.getItem(key)||'[]');
  tbody.innerHTML = arr.map((r,i)=>`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.score}</td></tr>`).join('') || '<tr><td colspan="3" style="opacity:.6">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</td></tr>';
}
function openRecords(){
  fillTable(REC_KEY_WORM, $$('#table-worm tbody'));
  fillTable(REC_KEY_CAT,  $$('#table-cat tbody'));
  $$('#modal').classList.add('show');
}
on($$('#btn-records'),'click',openRecords);
on($$('#close-modal'),'click',()=> $$('#modal').classList.remove('show'));

/* ======================= WORM (wormax-style) ======================= */
(()=> {
  const PLANETS = ["–ú–∞—Ä—Å","–ó–µ–º–ª—è","–Æ–ø–∏—Ç–µ—Ä","–í–µ–Ω–µ—Ä–∞","–°–∞—Ç—É—Ä–Ω","–ù–µ–ø—Ç—É–Ω","–ú–µ—Ä–∫—É—Ä–∏–π","–£—Ä–∞–Ω","–ü–ª—É—Ç–æ–Ω","–ï–≤—Ä–æ–ø–∞","–ò–æ","–¢–∏—Ç–∞–Ω","–ì–∞–Ω–∏–º–µ–¥","–ö–∞–ª–ª–∏—Å—Ç–æ","–¢—Ä–∏—Ç–æ–Ω"];
  const CFG = {
    world: 3200,
    baseSpeed: 2.3,
    boostMult: 1.5,
    turnRate: 0.10,
    space: 8,
    initLen: 28,
    radius: 12,
    foodR: 4,
    foodTarget: 160
  };

  let canvas, ctx, raf=null, running=false, last=0;
  let snakes=[], foods=[];
  let me=null, score=0, boost=false, invisibleUntil=0, ghostCdUntil=0;
  const cam={x:0,y:0,zoom:1,vw:0,vh:0};
  const touch={active:false,sx:0,sy:0,ex:0,ey:0};

  function newSnake(x,y,isPlayer=false,name='bot',color='#6bf2ff'){
    const dir = rand(0,Math.PI*2);
    const s={isPlayer, alive:true, name, dir, speed:CFG.baseSpeed, r:CFG.radius, wantGrow:0, color,
             segs:[], invisibleUntil:0};
    const L=CFG.initLen+Math.floor(rand(0,12));
    for(let i=0;i<L;i++)
      s.segs.push({x:x - i*CFG.space*Math.cos(dir), y:y - i*CFG.space*Math.sin(dir)});
    return s;
  }
  const head = s => s.segs[0];

  function spawnFoods(n=CFG.foodTarget){
    while(foods.length<n){
      foods.push({x:rand(40, CFG.world-40), y:rand(40, CFG.world-40)});
    }
  }
  function spawnMe(){
    const name = ($$('#player-name').value||'Kosmos').slice(0,16);
    me = newSnake(rand(800,1200), rand(800,1200), true, name, '#6bf2ff');
    snakes.push(me);
  }
  function spawnBots(){
    const need = clamp(parseInt($$('#bot-count').value||10,10),0,24);
    while (snakes.filter(s=>!s.isPlayer && s.alive).length < need){
      const name = PLANETS[Math.floor(Math.random()*PLANETS.length)];
      const col = ['#7eff6b','#ff6be6','#ffaa6b','#7aa3ff','#ffd86b'][Math.floor(Math.random()*5)];
      snakes.push(newSnake(rand(200,CFG.world-200),rand(200,CFG.world-200),false,name,col));
    }
  }
  function dropFood(s){ for(let i=0;i<s.segs.length;i+=2){ const p=s.segs[i]; foods.push({x:p.x,y:p.y}); } }

  function dist2(a,b){const dx=a.x-b.x, dy=a.y-b.y; return dx*dx+dy*dy;}
  function lerpAng(a,b,t){ let d=((b-a+Math.PI*3)%(Math.PI*2))-Math.PI; return a+d*t; }

  function updateSnake(s,dt){
    if(!s.alive) return;
    // —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (s.isPlayer){
      if (touch.active){
        const dx=touch.ex-touch.sx, dy=touch.ey-touch.sy;
        const ang=Math.atan2(dy,dx);
        if (isFinite(ang)) s.dir = lerpAng(s.dir, ang, CFG.turnRate*2);
      }
    } else {
      // –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –ò–ò
      s.dir += rand(-CFG.turnRate*0.4, CFG.turnRate*0.4);
    }

    const v = s.isPlayer && boost ? CFG.baseSpeed*CFG.boostMult : CFG.baseSpeed;
    const nx = head(s).x + Math.cos(s.dir)*v;
    const ny = head(s).y + Math.sin(s.dir)*v;
    s.segs.unshift({x:nx,y:ny});

    // –µ–¥–∞
    for(let i=foods.length-1;i>=0;i--){
      const f=foods[i];
      if (dist2(head(s), f) < (s.r+CFG.foodR)**2){
        foods.splice(i,1); s.wantGrow += 6;
        if (s.isPlayer){ score++; $$('#score-chip').textContent = score; }
      }
    }
    // —Ä–æ—Å—Ç/—Ö–≤–æ—Å—Ç
    if (s.wantGrow>0) s.wantGrow--;
    else if (s.segs.length>CFG.initLen) s.segs.pop();

    // —Ç–æ—Ä–µ—Ü –º–∏—Ä–∞
    const h=head(s);
    if (h.x<0) h.x += CFG.world; if (h.x>CFG.world) h.x -= CFG.world;
    if (h.y<0) h.y += CFG.world; if (h.y>CFG.world) h.y -= CFG.world;
  }

  function collide(){
    // –≥–æ–ª–æ–≤–∞ –≤ —Ç–µ–ª–æ –¥—Ä—É–≥–æ–π –∑–º–µ–∏ => —Å–º–µ—Ä—Ç—å
    for (let i=0;i<snakes.length;i++){
      const a=snakes[i]; if(!a.alive) continue;
      for (let j=0;j<snakes.length;j++){
        if (i===j) continue; const b=snakes[j]; if(!b.alive) continue;
        // —Ä–µ–∂–∏–º "–Ω–µ–≤–∏–¥–∏–º–∫–∞" —É –∏–≥—Ä–æ–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π, –∫–æ–ª–ª–∏–∑–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        const R2=(a.r + b.r*0.9)**2;
        const H=head(a);
        for (const seg of b.segs){
          if (dist2(H,seg) <= R2){
            a.alive=false; dropFood(a);
            if (a.isPlayer) gameOver();
            break;
          }
        }
      }
    }
    snakes = snakes.filter(s=>s.alive);
  }

  function resize(){
    canvas.width=innerWidth; canvas.height=innerHeight;
    const k=Math.min(innerWidth,innerHeight)/900;
    cam.zoom = clamp(k, .68, 1.15);
    cam.vw = canvas.width/cam.zoom; cam.vh = canvas.height/cam.zoom;
  }
  function updateCam(){
    if(!me) return;
    cam.x = head(me).x - cam.vw/2;
    cam.y = head(me).y - cam.vh/2;
    cam.x = clamp(cam.x, 0, CFG.world-cam.vw);
    cam.y = clamp(cam.y, 0, CFG.world-cam.vh);
  }

  // –†–∏—Å–æ–≤–∞–Ω–∏–µ
  function hexGrid(){
    const size=46, h=size*Math.sqrt(3)/2;
    ctx.save(); ctx.globalAlpha=.22; ctx.strokeStyle='#1ad19e'; ctx.lineWidth=1;
    let sx=Math.floor(cam.x/(size*1.5))-1, ex=Math.ceil((cam.x+cam.vw)/(size*1.5))+1;
    let sy=Math.floor(cam.y/h)-2,         ey=Math.ceil((cam.y+cam.vh)/h)+2;
    for (let i=sx;i<ex;i++){
      for (let j=sy;j<ey;j++){
        const cx = i*size*1.5, cy = j*h + (i%2?h/2:0);
        ctx.beginPath();
        for (let k=0;k<6;k++){
          const a=Math.PI/3*k, x=cx+size/2*Math.cos(a), y=cy+size/2*Math.sin(a);
          if(k===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.closePath(); ctx.stroke();
      }
    }
    ctx.restore();
  }
  function drawName(s){
    const h=head(s);
    ctx.font='12px Inter, system-ui';
    ctx.textAlign='center'; ctx.fillStyle='#dff';
    ctx.strokeStyle='rgba(0,0,0,.6)'; ctx.lineWidth=3;
    ctx.strokeText(s.name, h.x, h.y - s.r*1.8);
    ctx.fillText  (s.name, h.x, h.y - s.r*1.8);
  }
  function drawSnake(s){
    const r=s.r, h=head(s), t=s.segs[s.segs.length-1];
    // —Å–≤–µ—á–µ–Ω–∏–µ
    ctx.save(); ctx.globalCompositeOperation='lighter'; ctx.shadowColor=s.color; ctx.shadowBlur=24;
    ctx.lineWidth=r*2; ctx.lineCap='round'; ctx.lineJoin='round';
    ctx.beginPath(); ctx.moveTo(s.segs[0].x,s.segs[0].y); for(const p of s.segs) ctx.lineTo(p.x,p.y); ctx.strokeStyle=s.color; ctx.stroke(); ctx.restore();
    // —Ç–µ–ª–æ
    ctx.lineWidth=r*2; ctx.lineCap='round'; ctx.lineJoin='round';
    ctx.beginPath(); ctx.moveTo(s.segs[0].x,s.segs[0].y); for(const p of s.segs) ctx.lineTo(p.x,p.y); ctx.strokeStyle=s.color; ctx.stroke();
    // –≥–ª–∞–∑–∞ (–µ—Å–ª–∏ –Ω–µ ¬´–≤–∏–∑—É–∞–ª—å–Ω–æ –Ω–µ–≤–∏–¥–∏–º¬ª)
    if (performance.now() > s.invisibleUntil){
      const dpx=Math.cos(s.dir), dpy=Math.sin(s.dir), nx=-dpy, ny=dpx, off=r*.6, eye=r*.45;
      ctx.beginPath(); ctx.fillStyle='#fff';
      ctx.arc(h.x+nx*off+dpx*.6, h.y+ny*off+dpy*.6, eye, 0, Math.PI*2);
      ctx.arc(h.x-nx*off+dpx*.6, h.y-ny*off+dpy*.6, eye, 0, Math.PI*2);
      ctx.fill();
      ctx.beginPath(); ctx.fillStyle='#111';
      ctx.arc(h.x+nx*off+dpx*1.0, h.y+ny*off+dpy*1.0, eye*.45, 0, Math.PI*2);
      ctx.arc(h.x-nx*off+dpx*1.0, h.y-ny*off+dpy*1.0, eye*.45, 0, Math.PI*2);
      ctx.fill();
    } else {
      ctx.globalAlpha=.35;
      ctx.lineWidth=r*2; ctx.beginPath(); ctx.moveTo(s.segs[0].x,s.segs[0].y); for(const p of s.segs) ctx.lineTo(p.x,p.y); ctx.strokeStyle=s.color; ctx.stroke();
      ctx.globalAlpha=1;
    }
    drawName(s);
  }
  function draw(){
    ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.scale(cam.zoom,cam.zoom); ctx.translate(-cam.x,-cam.y);

    // —Ñ–æ–Ω
    const g=ctx.createRadialGradient(cam.x+cam.vw/2,cam.y+cam.vh/2,Math.min(cam.vw,cam.vh)*.2, cam.x+cam.vw/2,cam.y+cam.vh/2,Math.max(cam.vw,cam.vh)*.8);
    g.addColorStop(0,'#0a1020'); g.addColorStop(1,'#06101a'); ctx.fillStyle=g; ctx.fillRect(cam.x,cam.y,cam.vw,cam.vh);
    hexGrid();

    // –µ–¥–∞
    for(const f of foods){ ctx.beginPath(); ctx.arc(f.x,f.y,CFG.foodR,0,Math.PI*2); ctx.fillStyle='#00ffd5'; ctx.shadowColor='#00ffd5'; ctx.shadowBlur=12; ctx.fill(); ctx.shadowBlur=0; }

    // –∑–º–µ–∏
    for (const s of snakes) drawSnake(s);
  }

  function step(ts){
    if(!running) return;
    const dt = ts - last || 16; last = ts;

    for (const s of snakes) updateSnake(s, dt);
    collide();
    spawnBots();
    spawnFoods();
    updateCam();
    draw();

    raf = requestAnimationFrame(step);
  }

  function bindInput(){
    const onStart = e=>{const t=e.touches?e.touches[0]:e; touch.active=true; touch.sx=touch.ex=t.clientX; touch.sy=touch.ey=t.clientY;}
    const onMove  = e=>{if(!touch.active)return; const t=e.touches?e.touches[0]:e; touch.ex=t.clientX; touch.ey=t.clientY;}
    const onEnd   = ()=>{touch.active=false;}
    canvas.addEventListener('touchstart',onStart,{passive:true});
    canvas.addEventListener('touchmove', onMove ,{passive:true});
    canvas.addEventListener('touchend',  onEnd  ,{passive:true});
    canvas.addEventListener('mousedown', onStart);
    addEventListener('mousemove', onMove);
    addEventListener('mouseup',   onEnd);

    // –±—É—Å—Ç –∏ ¬´–≤–∏–∑—É–∞–ª—å–Ω–∞—è –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—å¬ª
    on($$('#btn-boost'),'touchstart',()=>{boost=true;},{passive:true});
    on($$('#btn-boost'),'touchend',  ()=>{boost=false;},{passive:true});
    on($$('#btn-boost'),'mousedown', ()=>{boost=true;});
    on(window,'mouseup',()=>{boost=false;});

    on($$('#btn-ghost'),'click',()=>{
      const now=performance.now();
      if(now>ghostCdUntil){
        invisibleUntil = now + 6000; // 6 —Å–µ–∫
        ghostCdUntil   = now + 12000;
        me.invisibleUntil = invisibleUntil;
      }
    });

    // –ü–ö
    on(window,'keydown',e=>{
      if(e.key.toLowerCase()==='shift') boost=true;
    });
    on(window,'keyup',e=>{
      if(e.key.toLowerCase()==='shift') boost=false;
    });
  }

  function startWorm(){
    if(running) return;
    canvas=document.createElement('canvas'); canvas.id='worm'; canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.zIndex='50'; canvas.style.touchAction='none';
    document.body.appendChild(canvas); ctx=canvas.getContext('2d');
    addEventListener('resize',resize); resize();
    snakes=[]; foods=[]; score=0; $$('#score-chip').textContent='0';
    spawnMe(); spawnBots(); spawnFoods();
    running=true; document.body.classList.add('playing-worm'); $$('#worm-hud').classList.add('show');
    bindInput();
    raf=requestAnimationFrame(step);
  }

  function stopWorm(save=true){
    running=false; if(raf) cancelAnimationFrame(raf);
    removeEventListener('resize',resize);
    if (canvas) canvas.remove();
    $$('#worm-hud').classList.remove('show');
    document.body.classList.remove('playing-worm');
    if (save && me) pushRecord(REC_KEY_WORM, me.name, score);
  }

  function gameOver(){
    stopWorm(true);
  }

  // –ü—É–±–ª–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
  on($$('#play-worm'),'click',startWorm);
  on($$('#btn-menu'),'click',()=>{ stopWorm(false); stopCat(false); });
})();

/* ======================= CAT (–ø—Ä—ã–∂–∫–∏ –≤–≤–µ—Ä—Ö) ======================= */
(()=>{
  let canvas, ctx, raf=null, running=false;
  const cat={x:200,y:0,vx:0,vy:-8,r:26,maxVx:4,jump:-10};
  let camY=0, score=0, bestY=0;
  let plats=[];  // {x,y,w}
  const touch={L:false,R:false};

  function reset(){
    plats=[]; score=0; bestY=0; camY=0;
    cat.x=innerWidth/2; cat.y=0; cat.vx=0; cat.vy=-8;
    // –±–∞–∑–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    for(let i=0;i<40;i++) addPlat(-i*80);
  }
  function addPlat(y){
    const w = rand(70,140);
    const x = rand(10, (innerWidth - 20 - w));
    plats.push({x,y,w});
  }
  function ensurePlats(){
    // –≥–µ–Ω–µ—Ä–∏–º –≤—ã—à–µ —Ç–µ–∫—É—â–µ–π –∫–∞–º–µ—Ä—ã
    const topY = Math.min(...plats.map(p=>p.y));
    while (topY > camY - 1200){
      addPlat(topY - rand(70,110));
    }
    // —á–∏—Å—Ç–∏–º —Å–∏–ª—å–Ω–æ —Å–Ω–∏–∑—É
    plats = plats.filter(p=>p.y < camY + innerHeight + 200);
  }

  function input(){
    let ax = 0;
    if (touch.L) ax -= 0.5;
    if (touch.R) ax += 0.5;
    cat.vx += ax;
    cat.vx = clamp(cat.vx, -cat.maxVx, cat.maxVx);
  }

  function physics(){
    cat.vy += 0.35; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
    cat.x  += cat.vx;
    cat.y  += cat.vy;

    // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
    if (cat.x < -cat.r) cat.x = innerWidth + cat.r;
    if (cat.x > innerWidth + cat.r) cat.x = -cat.r;

    // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
    if (cat.vy > 0){
      for (const p of plats){
        if (cat.y + cat.r > p.y && cat.y + cat.r < p.y + 12 && cat.x > p.x && cat.x < p.x + p.w){
          cat.vy = cat.jump; // –ø–æ–¥–ø—Ä—ã–≥–Ω—É–ª–∏
        }
      }
    }

    // –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –≤–≤–µ—Ä—Ö
    camY = Math.min(camY, cat.y - innerHeight*0.45);
    score = Math.max(score, Math.round(-(cat.y - 0))); // —á–µ–º –≤—ã—à–µ, —Ç–µ–º –±–æ–ª—å—à–µ
  }

  function drawCat(){
    const x=cat.x, y=cat.y - camY, r=cat.r;
    // —Ç–µ–ª–æ
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle='#ffdba6'; ctx.fill();
    // —Å–∫–∞—Ñ–∞–Ω–¥—Ä (—à–ª–µ–º)
    ctx.beginPath(); ctx.arc(x,y,r*1.1,0,Math.PI*2); ctx.strokeStyle='rgba(130,200,255,.7)'; ctx.lineWidth=8; ctx.stroke();
    // –≤–∏–∑–æ—Ä
    ctx.beginPath(); ctx.arc(x+r*0.2,y-r*0.15,r*0.55,Math.PI*0.15,Math.PI*1.15); ctx.strokeStyle='rgba(130,200,255,.35)'; ctx.lineWidth=6; ctx.stroke();
    // —É—à–∫–∏
    ctx.beginPath(); ctx.moveTo(x-r*0.6,y-r*0.2); ctx.lineTo(x-r*1.0,y-r*1.0); ctx.lineTo(x-r*0.2,y-r*0.7); ctx.closePath(); ctx.fillStyle='#ffb77a'; ctx.fill();
    ctx.beginPath(); ctx.moveTo(x+r*0.6,y-r*0.2); ctx.lineTo(x+r*1.0,y-r*1.0); ctx.lineTo(x+r*0.2,y-r*0.7); ctx.closePath(); ctx.fillStyle='#ffb77a'; ctx.fill();
    // –≥–ª–∞–∑–∞
    ctx.beginPath(); ctx.fillStyle='#222'; ctx.arc(x-r*0.35,y-r*0.1,r*0.18,0,Math.PI*2); ctx.arc(x+r*0.35,y-r*0.1,r*0.18,0,Math.PI*2); ctx.fill();
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // —Ñ–æ–Ω
    const g=ctx.createLinearGradient(0,0,0,innerHeight); g.addColorStop(0,'#0c1430'); g.addColorStop(1,'#091224'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
    // –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    ctx.fillStyle='#1ed1a0';
    for (const p of plats){
      const y = p.y - camY;
      if (y>-40 && y<innerHeight+40){
        ctx.fillRect(p.x, y, p.w, 10);
      }
    }
    // –∫–æ—Ç
    drawCat();

    // —Å—á—ë—Ç
    const chip = $$('#score-chip'); chip.textContent = score;
  }

  function step(){
    if(!running) return;
    input(); physics(); ensurePlats(); draw();
    raf=requestAnimationFrame(step);
  }

  function resize(){
    canvas.width=innerWidth; canvas.height=innerHeight;
    ensurePlats();
  }

  function bindInput(){
    // –±–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏
    on($$('#cat-left'),'touchstart',()=>{touch.L=true;},{passive:true});
    on($$('#cat-left'),'touchend',  ()=>{touch.L=false;},{passive:true});
    on($$('#cat-right'),'touchstart',()=>{touch.R=true;},{passive:true});
    on($$('#cat-right'),'touchend',  ()=>{touch.R=false;},{passive:true});
    on($$('#cat-left'),'mousedown', ()=>{touch.L=true;});
    on($$('#cat-right'),'mousedown',()=>{touch.R=true;});
    on(window,'mouseup',()=>{touch.L=false;touch.R=false;});
    // —Ç–∞–∫–∂–µ —Å–≤–∞–π–ø—ã: –ª–µ–≤–∞—è/–ø—Ä–∞–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞
    on(canvas,'touchstart',e=>{ const x=e.touches[0].clientX; if(x<innerWidth/2) touch.L=true; else touch.R=true; },{passive:true});
    on(canvas,'touchend',()=>{touch.L=false;touch.R=false;},{passive:true});
    // –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
    on(window,'keydown',e=>{const k=e.key.toLowerCase(); if(['arrowleft','a'].includes(k))touch.L=true; if(['arrowright','d'].includes(k))touch.R=true;});
    on(window,'keyup',e=>{const k=e.key.toLowerCase(); if(['arrowleft','a'].includes(k))touch.L=false; if(['arrowright','d'].includes(k))touch.R=false;});
  }

  function startCat(){
    if(running) return;
    canvas=document.createElement('canvas'); canvas.id='cat'; canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.zIndex='50'; canvas.style.touchAction='none';
    document.body.appendChild(canvas); ctx=canvas.getContext('2d');
    addEventListener('resize',resize); resize(); reset(); bindInput();
    running=true; document.body.classList.add('playing-cat'); $$('#cat-hud').classList.add('show');
    raf=requestAnimationFrame(step);
  }
  function stopCat(save=true){
    running=false; if(raf) cancelAnimationFrame(raf);
    removeEventListener('resize',resize);
    if(canvas) canvas.remove();
    document.body.classList.remove('playing-cat'); $$('#cat-hud').classList.remove('show');
    if (save){ const name = ($$('#player-name').value||'Kosmos').slice(0,16); pushRecord(REC_KEY_CAT, name, score); }
  }

  // —ç–∫—Å–ø–æ—Ä—Ç –≤ –≥–ª–æ–±–∞–ª, —á—Ç–æ–±—ã –º–µ–Ω—é –º–æ–≥–ª–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å
  window.stopCat = stopCat;

  on($$('#play-cat'),'click',startCat);
  on($$('#btn-menu'),'click',()=> stopCat(false));
})();

/* ======= –ö–ù–û–ü–ö–ê "–í –ú–ï–ù–Æ" –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±–µ –∏–≥—Ä—ã ======= */
on($$('#btn-menu'),'click',()=>{
  // –µ—Å–ª–∏ worm –∑–∞–ø—É—â–µ–Ω ‚Äî –æ–Ω —Å–∞–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∫–æ—Ä–¥ –≤ —Å–≤–æ—ë–º stop
  // –µ—Å–ª–∏ cat –∑–∞–ø—É—â–µ–Ω ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–∞–µ–º (false), —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–π—Ç–∏
});
</script>
</body>
</html>