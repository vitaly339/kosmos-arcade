<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KOSMOS.ARCADE ‚Äî Worm & Cat</title>
<meta name="theme-color" content="#0b1020" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Inter',system-ui,Arial;background:#0b1020;color:#fff;overflow:hidden}
.bg{position:fixed;inset:0;background:
  radial-gradient(1200px 600px at 20% 0%,#1b1f3d 0%,transparent 55%),
  radial-gradient(1200px 600px at 80% 100%,#13233a 0%,transparent 55%);z-index:-2}
.top{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:rgba(0,0,0,.35);
     border-bottom:1px solid rgba(255,255,255,.1);backdrop-filter:blur(10px)}
.brand{display:flex;gap:8px;align-items:center;font-family:'Russo One',sans-serif;font-size:20px;letter-spacing:1px}
.brand em{color:#39f3ff;font-style:normal}
.actions{display:flex;gap:8px}
.chip{padding:6px 12px;border-radius:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);color:#fff}
.btn{cursor:pointer;transition:transform .1s, background .2s}
.btn:hover{background:rgba(255,255,255,.15)}
.btn:active{transform:scale(.96)}

.main{max-width:1100px;margin:0 auto;padding:24px;display:flex;gap:24px;align-items:center;justify-content:space-between}
.h1{font-family:'Russo One',sans-serif;font-size:clamp(28px,6vw,56px);text-shadow:0 0 8px #39f3ff,0 0 18px #39f3ff}
.p{margin:14px 0 18px;color:#cbd3ff99;line-height:1.6;max-width:720px}
.modes{display:flex;gap:14px}
.mode{flex:1;min-width:160px;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,.1);
      background:linear-gradient(145deg,#151c3a,#0a0f20);display:flex;flex-direction:column;align-items:center;gap:6px}
.mode .ico{font-size:28px}
.art{flex:1;position:relative}
.art .box{height:300px;border-radius:14px;background:linear-gradient(135deg,#1a2242,#0d1326);box-shadow:0 0 18px #39f3ff33}
.art .shine{position:absolute;inset:0;border-radius:14px;pointer-events:none;background:linear-gradient(135deg,rgba(255,255,255,.12),transparent 60%)}
.footer{padding:10px 0;text-align:center;color:#9aa1b6;border-top:1px solid rgba(255,255,255,.1)}

@media (max-width: 820px){
  .main{flex-direction:column}
  .art{order:-1;width:100%}
  .art .box{height:200px}
}

/* HUD –¥–ª—è Worm */
.hud{position:fixed;inset:0;pointer-events:none;z-index:60;display:none}
.hud__btn{position:absolute;pointer-events:auto;border:none;border-radius:999px;background:rgba(255,255,255,.08);
          border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);color:#fff}
.hud__boost{right:14px;bottom:16px;width:74px;height:74px;font-size:12px}
.hud__invis{left:14px;bottom:16px;width:74px;height:74px;font-size:12px}
.hud__ring{position:absolute;inset:0;border-radius:999px;box-shadow:0 0 14px #39f3ff77 inset}
.hud__label{position:absolute;left:0;right:0;bottom:8px;text-align:center;font-size:12px;color:#cbd3ffcc}
.hud.show{display:block}

/* –ø—Ä—è—á–µ–º –º–µ–Ω—é, –∫–æ–≥–¥–∞ –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ */
body.playing-worm .top, body.playing-worm .main, body.playing-worm .footer{display:none}
body.playing-cat  .top, body.playing-cat  .main, body.playing-cat  .footer{display:none}
</style>
</head>
<body>
<div class="bg"></div>

<header class="top">
  <div class="brand">‚ú¶ <span>KOSMOS.<em>ARCADE</em></span></div>
  <div class="actions">
    <div class="chip" id="score">0</div>
    <button class="chip btn" id="to-menu">–í –º–µ–Ω—é</button>
  </div>
</header>

<main class="main">
  <section>
    <h1 class="h1">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º</h1>
    <p class="p">
      <b>Worm</b>: —Å–≤–µ—Ç—è—â–∞—è—Å—è –∑–º–µ–π–∫–∞ —Å –Ω–µ–≤–∏–¥–∏–º—ã–º –¥–∂–æ–π—Å—Ç–∏–∫–æ–º, –∫–Ω–æ–ø–∫–æ–π —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏ —Ä–µ–∂–∏–º–æ–º –Ω–µ–≤–∏–¥–∏–º–∫–∏.<br>
      <b>Cat</b>: —à–∞—Ä-–∫–æ—Ç–∏–∫ —Å —É—à–∫–∞–º–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏/–∫–ª–∞–≤–∏—à–∞–º–∏.
    </p>
    <div class="modes">
      <button class="mode btn" id="play-worm"><span class="ico">üêç</span><span>Worm</span></button>
      <button class="mode btn" id="play-cat"><span class="ico">üê±</span><span>Cat</span></button>
    </div>
  </section>
  <figure class="art">
    <div class="box"></div><div class="shine"></div>
  </figure>
</main>

<footer class="footer">made by kosmos.bud 2k25</footer>

<!-- HUD –¥–ª—è Worm -->
<div class="hud" id="worm-hud">
  <button class="hud__btn hud__invis" id="btn-invis" aria-label="–ù–µ–≤–∏–¥–∏–º–∫–∞">
    <div class="hud__ring"></div>
    üëª
  </button>
  <button class="hud__btn hud__boost" id="btn-boost" aria-label="–£—Å–∫–æ—Ä–µ–Ω–∏–µ">
    <div class="hud__ring"></div>
    ‚ö°
  </button>
  <div class="hud__label">–£—Å–∫–æ—Ä–µ–Ω–∏–µ / –ù–µ–≤–∏–¥–∏–º–∫–∞</div>
</div>

<script>
/* ========= WORM (–Ω–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ + —É—Å–∫–æ—Ä–µ–Ω–∏–µ + –Ω–µ–≤–∏–¥–∏–º–∫–∞) ========= */
(() => {
  const CFG = {
    worldSize:2600, baseSpeed:2.25, boostMult:1.55,
    turnRate:0.10, segSpacing:8, initLen:28, snakeRadius:12, foodRadius:4,
    bots:3, growthPerFood:6, dropEveryN:2,
    invisDuration:6000, invisCooldown:12000  // –º—Å
  };
  const rand=(a,b)=>a+Math.random()*(b-a), clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const dist2=(a,b)=>{const dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy;}
  const lerpAng=(a,b,t)=>{let d=((b-a+Math.PI*3)%(Math.PI*2))-Math.PI;return a+d*t;}

  let canvas,ctx,raf,running=false,last=0,snakes=[],foods=[],player=null,score=0;
  const cam={x:0,y:0,zoom:1,vw:0,vh:0};
  const touch={active:false,sx:0,sy:0,ex:0,ey:0};
  const HUD = {root:document.getElementById('worm-hud'),
               boostBtn:document.getElementById('btn-boost'),
               invisBtn:document.getElementById('btn-invis')};

  class Snake{
    constructor(x,y,isP=false,col='#6bf2ff'){
      this.isPlayer=isP; this.alive=true; this.dir=rand(0,Math.PI*2);
      this.speed=CFG.baseSpeed; this.radius=CFG.snakeRadius;
      this.wantGrow=0; this.color=col;
      this.invisUntil=0; this.invisCdUntil=0;
      this.segs=[];
      for(let i=0;i<CFG.initLen;i++) this.segs.push({x:x-i*CFG.segSpacing,y:y});
    }
    head(){return this.segs[0]}
    isInvisible(now){ return now < this.invisUntil; }
    canInvis(now){ return now >= this.invisCdUntil; }

    update(now){
      if(!this.alive) return;
      // –ù–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è
      if(this.isPlayer && touch.active){
        const dx=touch.ex-touch.sx, dy=touch.ey-touch.sy;
        const a=Math.atan2(dy,dx); if(isFinite(a)) this.dir=lerpAng(this.dir,a,CFG.turnRate*2);
      } else if(!this.isPlayer){
        this.dir += rand(-CFG.turnRate*0.4, CFG.turnRate*0.4);
      }

      // —Å–∫–æ—Ä–æ—Å—Ç—å c —É—á—ë—Ç–æ–º –±—É—Å—Ç–∞
      const v = this.isPlayer && boostHeld ? CFG.baseSpeed*CFG.boostMult : CFG.baseSpeed;

      // –¥–≤–∏–∂–µ–Ω–∏–µ
      const nx=this.head().x+Math.cos(this.dir)*v;
      const ny=this.head().y+Math.sin(this.dir)*v;
      this.segs.unshift({x:nx,y:ny});

      // –µ–¥–∞
      for(let i=foods.length-1;i>=0;i--){
        const f=foods[i];
        if(dist2(this.head(),f)<(this.radius+CFG.foodRadius)**2){
          foods.splice(i,1);
          this.wantGrow+=CFG.growthPerFood;
          if(this.isPlayer){ score++; document.getElementById('score').textContent=score; }
        }
      }
      // —Ö–≤–æ—Å—Ç ‚Äî –Ω–µ –∫–æ—Ä–æ—á–µ initLen
      if(this.wantGrow>0) this.wantGrow--; else if(this.segs.length>CFG.initLen) this.segs.pop();

      // —Ç–æ—Ä–µ—Ü
      const h=this.head(); if(h.x<0)h.x+=CFG.worldSize; if(h.x>CFG.worldSize)h.x-=CFG.worldSize;
      if(h.y<0)h.y+=CFG.worldSize; if(h.y>CFG.worldSize)h.y-=CFG.worldSize;
    }
  }

  function dropFood(s){ for(let i=0;i<s.segs.length;i+=CFG.dropEveryN) foods.push({...s.segs[i]}); }
  function hitHeadBody(a,b){ // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è: –Ω–µ–≤–∏–¥–∏–º–∫–∞ –ù–ï –¥–µ–ª–∞–µ—Ç –±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–º, —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä—è—á–µ—Ç
    const h=a.head(); const R2=(a.radius+b.radius*0.9)**2;
    for(const seg of b.segs){ if(dist2(h,seg)<=R2) return true; }
    return false;
  }
  function collide(now){
    for(const s of snakes){
      if(!s.alive) continue;
      for(const o of snakes){
        if(s===o || !o.alive) continue;
        if(hitHeadBody(s,o)){ s.alive=false; dropFood(s); if(s.isPlayer) gameOver(); }
      }
    }
    snakes = snakes.filter(s=>s.alive);
  }

  function resize(){
    canvas.width=innerWidth; canvas.height=innerHeight;
    const k=Math.min(innerWidth,innerHeight)/900;
    cam.zoom=Math.max(.68,Math.min(1.15,k));
    cam.vw=canvas.width/cam.zoom; cam.vh=canvas.height/cam.zoom;
  }
  function updateCam(){ if(!player) return;
    cam.x=player.head().x-cam.vw/2; cam.y=player.head().y-cam.vh/2;
    cam.x=clamp(cam.x,0,CFG.worldSize-cam.vw); cam.y=clamp(cam.y,0,CFG.worldSize-cam.vh);
  }

  function drawSnake(s, now){
    const r=s.radius;
    // –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç–∏
    const alpha = s.isInvisible(now) ? 0.25 : 1;

    // –ø—Ä–æ—Å—Ç–∞—è —Ç—Ä—É–±–∫–∞ + –ª—ë–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ (—á—Ç–æ–±—ã –Ω–µ —Ç–æ—Ä–º–æ–∑–∏–ª–æ)
    ctx.globalAlpha = Math.min(alpha*1.0, 1);
    ctx.lineCap='round'; ctx.lineJoin='round';
    ctx.lineWidth = r*2;
    ctx.beginPath(); ctx.moveTo(s.segs[0].x,s.segs[0].y);
    for(const p of s.segs) ctx.lineTo(p.x,p.y);
    ctx.strokeStyle = s.color; ctx.stroke();

    if(!s.isInvisible(now)){
      // –≥–ª–∞–∑–∫–∏
      const h=s.head(), dpx=Math.cos(s.dir), dpy=Math.sin(s.dir), nx=-dpy, ny=dpx, off=r*.6, eyeR=r*.45;
      ctx.globalAlpha = 1;
      ctx.beginPath(); ctx.arc(h.x+nx*off+dpx*.6,h.y+ny*off+dpy*.6,eyeR,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
      ctx.beginPath(); ctx.arc(h.x-nx*off+dpx*.6,h.y-ny*off+dpy*.6,eyeR,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
      ctx.beginPath(); ctx.arc(h.x+nx*off+dpx*1.0,h.y+ny*off+dpy*1.0,eyeR*.45,0,Math.PI*2); ctx.fillStyle='#111'; ctx.fill();
      ctx.beginPath(); ctx.arc(h.x-nx*off+dpx*1.0,h.y-ny*off+dpy*1.0,eyeR*.45,0,Math.PI*2); ctx.fillStyle='#111'; ctx.fill();
    }
    ctx.globalAlpha = 1;
  }

  function draw(now){
    ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.scale(cam.zoom,cam.zoom); ctx.translate(-cam.x,-cam.y);

    // —Ñ–æ–Ω —Ç—ë–º–Ω—ã–π
    ctx.fillStyle='#06101a'; ctx.fillRect(cam.x,cam.y,cam.vw,cam.vh);
    // –µ–¥–∞
    for(const f of foods){ ctx.beginPath(); ctx.arc(f.x,f.y,CFG.foodRadius,0,Math.PI*2); ctx.fillStyle='#00ffd5'; ctx.fill(); }
    // –∑–º–µ–∏
    for(const s of snakes) drawSnake(s, now);

    // –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–≤–∏–¥–∏–º–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ
    if(player){
      const nowMs = now;
      const cdLeft = Math.max(0, player.invisCdUntil - nowMs);
      const durLeft = Math.max(0, player.invisUntil - nowMs);
      HUD.invisBtn.style.opacity = player.canInvis(nowMs) ? '1' : '.6';
      HUD.invisBtn.textContent = durLeft>0 ? 'üëª' : (cdLeft>0 ? Math.ceil(cdLeft/1000)+'s' : 'üëª');
    }
  }

  function step(ts){
    if(!running) return;
    const now = performance.now();
    for(const s of snakes) s.update(now);
    collide(now); updateCam(); draw(now);
    raf=requestAnimationFrame(step);
  }

  function spawnFoods(){ foods.length=0; for(let i=0;i<90;i++) foods.push({x:rand(60,CFG.worldSize-60),y:rand(60,CFG.worldSize-60)}); }
  function spawn(){
    snakes.length=0; score=0; document.getElementById('score').textContent='0';
    player = new Snake(400,400,true,'#6bf2ff'); snakes.push(player);
    for(let i=0;i<CFG.bots;i++){ snakes.push(new Snake(rand(200,CFG.worldSize-200), rand(200,CFG.worldSize-200), false, '#ffaa6b')); }
    spawnFoods();
  }

  let boostHeld=false;

  function start(){
    if(running) return;
    canvas=document.createElement('canvas');
    canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.zIndex='50'; canvas.style.touchAction='none';
    document.body.appendChild(canvas);
    ctx=canvas.getContext('2d');
    addEvents(); resize(); spawn();
    running=true; document.body.classList.add('playing-worm');
    HUD.root.classList.add('show');
    raf=requestAnimationFrame(step);
  }
  function stop(){
    running=false; if(raf) cancelAnimationFrame(raf);
    removeEvents(); if(canvas) canvas.remove();
    HUD.root.classList.remove('show');
    snakes=[]; foods=[];
    document.body.classList.remove('playing-worm');
  }
  function gameOver(){ running=false; setTimeout(stop,400); }

  // —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  function addEvents(){
    addEventListener('resize',resize);
    // –ù–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫: –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —ç–∫—Ä–∞–Ω–∞
    const onStart=e=>{const t=e.touches?e.touches[0]:e; touch.active=true; touch.sx=touch.ex=t.clientX; touch.sy=touch.ey=t.clientY;}
    const onMove =e=>{if(!touch.active)return; const t=e.touches?e.touches[0]:e; touch.ex=t.clientX; touch.ey=t.clientY;}
    const onEnd  =()=>{touch.active=false; if(player) player.speed=CFG.baseSpeed;}
    canvas.addEventListener('touchstart',onStart,{passive:true});
    canvas.addEventListener('touchmove', onMove ,{passive:true});
    canvas.addEventListener('touchend',  onEnd  ,{passive:true});
    canvas.addEventListener('mousedown', onStart);
    addEventListener('mousemove', onMove);
    addEventListener('mouseup',   onEnd);

    // –∫–Ω–æ–ø–∫–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è
    HUD.boostBtn.addEventListener('touchstart', ()=>{boostHeld=true;},{passive:true});
    HUD.boostBtn.addEventListener('touchend',   ()=>{boostHeld=false;},{passive:true});
    HUD.boostBtn.addEventListener('mousedown',  ()=>{boostHeld=true;});
    addEventListener('mouseup',                 ()=>{boostHeld=false;});

    // –Ω–µ–≤–∏–¥–∏–º–∫–∞
    HUD.invisBtn.addEventListener('click', ()=>{
      const now = performance.now();
      if(!player) return;
      if(player.canInvis(now)){
        player.invisUntil = now + CFG.invisDuration;
        player.invisCdUntil = now + CFG.invisCooldown;
      }
    });

    // –ü–ö: —Å—Ç—Ä–µ–ª–∫–∏/WASD –∏ Shift ‚Äî –±—É—Å—Ç
    addEventListener('keydown', e=>{
      if(!player) return; const k=e.key.toLowerCase();
      if(k==='shift') boostHeld=true;
      if(k==='arrowleft'||k==='a') player.dir-=.22;
      if(k==='arrowright'||k==='d') player.dir+=.22;
      if(k==='arrowup'||k==='w') player.speed=CFG.baseSpeed*CFG.boostMult*.9;
      if(k==='arrowdown'||k==='s') player.speed=CFG.baseSpeed*0.8;
    });
    addEventListener('keyup', e=>{
      if(!player) return; const k=e.key.toLowerCase();
      if(k==='shift') boostHeld=false;
      if(['arrowup','w','arrowdown','s'].includes(k)) player.speed=CFG.baseSpeed;
    });
  }
  function removeEvents(){ removeEventListener('resize',resize); }

  document.getElementById('play-worm').addEventListener('click', start);
  document.getElementById('to-menu').addEventListener('click', stop);
})();
</script>

<script>
/* ========= CAT (—Å–≤–∞–π–ø/–∫–ª–∞–≤–∏—à–∏) ========= */
(() => {
  let canvas, ctx, raf, running = false;
  const cat = {x:300,y:300,vx:3,vy:2,r:30,speed:3.2,maxSpeed:5.2};
  const touch={active:false,sx:0,sy:0,ex:0,ey:0};

  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
  function setDir(dx,dy,boost=false){
    const len=Math.hypot(dx,dy)||1, k=Math.min(1,len/60), spd=(boost?cat.maxSpeed:cat.speed)*k;
    cat.vx=(dx/len)*spd; cat.vy=(dy/len)*spd;
  }

  function drawCat(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath();ctx.arc(cat.x,cat.y,cat.r,0,Math.PI*2);ctx.fillStyle='#ffcc66';ctx.fill();
    // —É—à–∫–∏
    ctx.beginPath();ctx.moveTo(cat.x-cat.r*0.6,cat.y-cat.r*0.2);ctx.lineTo(cat.x-cat.r*1.0,cat.y-cat.r*1.0);ctx.lineTo(cat.x-cat.r*0.2,cat.y-cat.r*0.7);ctx.closePath();ctx.fillStyle='#ff9966';ctx.fill();
    ctx.beginPath();ctx.moveTo(cat.x+cat.r*0.6,cat.y-cat.r*0.2);ctx.lineTo(cat.x+cat.r*1.0,cat.y-cat.r*1.0);ctx.lineTo(cat.x+cat.r*0.2,cat.y-cat.r*0.7);ctx.closePath();ctx.fillStyle='#ff9966';ctx.fill();
    // –≥–ª–∞–∑–∞
    ctx.beginPath();ctx.arc(cat.x-cat.r*0.35,cat.y-cat.r*0.15,cat.r*0.18,0,Math.PI*2);
    ctx.arc(cat.x+cat.r*0.35,cat.y-cat.r*0.15,cat.r*0.18,0,Math.PI*2);ctx.fillStyle='#222';ctx.fill();
  }

  function update(){
    cat.x+=cat.vx; cat.y+=cat.vy;
    cat.vx*=0.995; cat.vy*=0.995;
    if(cat.x<cat.r){cat.x=cat.r;cat.vx=Math.abs(cat.vx);}
    if(cat.x>canvas.width-cat.r){cat.x=canvas.width-cat.r;cat.vx=-Math.abs(cat.vx);}
    if(cat.y<cat.r){cat.y=cat.r;cat.vy=Math.abs(cat.vy);}
    if(cat.y>canvas.height-cat.r){cat.y=canvas.height-cat.r;cat.vy=-Math.abs(cat.vy);}
  }

  function step(){ if(!running) return; update(); drawCat(); raf=requestAnimationFrame(step); }

  function start(){
    if(running) return;
    canvas=document.createElement('canvas'); canvas.style.position='fixed'; canvas.style.inset='0'; canvas.style.zIndex='50'; canvas.style.touchAction='none';
    document.body.appendChild(canvas); ctx=canvas.getContext('2d'); addEvents(); resize(); running=true; document.body.classList.add('playing-cat'); raf=requestAnimationFrame(step);
  }
  function stop(){ running=false; if(raf) cancelAnimationFrame(raf); removeEvents(); if(canvas) canvas.remove(); document.body.classList.remove('playing-cat'); }

  function addEvents(){
    addEventListener('resize',resize);
    const onStart=e=>{const t=e.touches?e.touches[0]:e; touch.active=true; touch.sx=touch.ex=t.clientX; touch.sy=touch.ey=t.clientY;};
    const onMove =e=>{if(!touch.active)return; const t=e.touches?e.touches[0]:e; touch.ex=t.clientX; touch.ey=t.clientY; setDir(touch.ex-touch.sx,touch.ey-touch.sy);};
    const onEnd  =()=>{touch.active=false;};
    canvas.addEventListener('touchstart',onStart,{passive:true});
    canvas.addEventListener('touchmove', onMove ,{passive:true});
    canvas.addEventListener('touchend',  onEnd  ,{passive:true});
    canvas.addEventListener('mousedown', onStart);
    addEventListener('mousemove', onMove);
    addEventListener('mouseup',   onEnd);

    addEventListener('keydown', e=>{
      const k=e.key.toLowerCase(), boost=e.shiftKey;
      if(['arrowleft','a'].includes(k))  setDir(-1,0,boost);
      if(['arrowright','d'].includes(k)) setDir( 1,0,boost);
      if(['arrowup','w'].includes(k))    setDir( 0,-1,boost);
      if(['arrowdown','s'].includes(k))  setDir( 0, 1,boost);
    });
  }
  function removeEvents(){ removeEventListener('resize',resize); }

  document.getElementById('play-cat').addEventListener('click', start);
  document.getElementById('to-menu').addEventListener('click', stop);
})();
</script>
</body>
</html>