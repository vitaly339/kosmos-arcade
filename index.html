<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>KOSMOS.WORM</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{background:#0b1020;color:#fff;font-family:system-ui,Arial;overflow:hidden}

/* ===== ЗАСТАВКА (меню) ===== */
.header{position:fixed;left:0;right:0;top:0;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;z-index:5}
.brand{font-weight:900;letter-spacing:.5px}
.row{display:flex;gap:8px;align-items:center}
.input,.btn{padding:8px 10px;border-radius:10px;border:1px solid #ffffff2a;background:#ffffff10;color:#fff}
.btn{cursor:pointer}

.menu{position:fixed;inset:58px 0 0 0;display:grid;grid-template-columns:1fr;place-items:center;gap:18px;padding:14px;overflow:auto}
.hero{width:min(1100px,94vw);display:grid;grid-template-columns:1fr;gap:14px}
.hero__art{width:100%;aspect-ratio:16/9;border-radius:16px;overflow:hidden;border:1px solid #ffffff22;background:
  radial-gradient(120% 100% at 80% -10%,#2f165a66 0%,transparent 50%),
  radial-gradient(120% 100% at -20% 120%,#0ac6ff33 0%,transparent 60%),
  #0f1630}
.hero__art img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.04) saturate(1.08)}
.hero h1{font-size:clamp(28px,6vw,46px);text-transform:uppercase;letter-spacing:1px}
.hero p{opacity:.9}
.actions{display:flex;gap:10px;flex-wrap:wrap}

.card{width:min(1100px,94vw);border:1px solid #ffffff22;border-radius:16px;background:#0e152d;box-shadow:0 10px 30px #0007;padding:14px}

/* ===== Игровой HUD (виден только во время игры) ===== */
.gamebar{position:fixed;left:0;right:0;top:0;display:none;align-items:center;justify-content:space-between;padding:8px 10px;z-index:6;background:#0008;border-bottom:1px solid #ffffff20}
.gamebar .score{padding:8px 12px;border-radius:10px;border:1px solid #ffffff2e;background:#0008}
#pauseBtn{padding:8px 12px;border-radius:10px;border:1px solid #ffffff28;background:#0008;color:#fff}

.minimap{position:fixed;right:10px;top:10px;width:110px;height:110px;border-radius:999px;border:1px solid #27c8ff66;background:#071423cc;backdrop-filter:blur(8px);z-index:6;display:none}
#mini{width:100%;height:100%;border-radius:999px}

/* невидимые зоны управления */
.hud{position:fixed;inset:0;pointer-events:auto;display:none;z-index:5}
#boostArea{position:absolute;left:12px;bottom:12px;width:120px;height:120px;border-radius:999px;opacity:0;touch-action:none}
#aimArea{position:absolute;right:0;top:0;bottom:0;width:55vw;opacity:0;touch-action:none}

/* модалка паузы */
.modal{position:fixed;inset:0;background:#0009;backdrop-filter:blur(8px);display:none;z-index:10;align-items:center;justify-content:center;padding:18px}
.modal.show{display:flex}
.box{width:min(420px,92vw);background:#111a35;border:1px solid #ffffff26;border-radius:14px}
.box h3{margin:0;padding:12px;border-bottom:1px solid #ffffff20}
.box .body{padding:12px;display:flex;gap:10px;flex-wrap:wrap}
.box .btn{flex:1}

/* on/off */
.playing .header, .playing .menu{display:none}
.playing .gamebar, .playing .minimap, .playing .hud{display:flex}
</style>
</head>
<body>

<!-- ===== ЗАСТАВКА ===== -->
<header class="header">
  <div class="brand">KOSMOS.WORM</div>
  <div class="row">
    <span>Имя</span><input id="playerName" class="input" value="Kosmos" maxlength="16" style="width:130px">
    <span>Ботов</span><input id="botCount" class="input" type="number" min="0" max="40" value="12" style="width:70px">
  </div>
</header>

<main class="menu" id="menu">
  <section class="hero">
    <figure class="hero__art">
      <!-- ЗАГЛУШКА. Кинь сюда свою картинку: /assets/cover.png -->
      <img src="./assets/cover.png" alt="Креативная обложка игры" onerror="this.src='data:image/svg+xml;utf8,\
      <svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 1200 675&quot;>\
      <defs><linearGradient id=&quot;g&quot; x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;1&quot; y2=&quot;1&quot;>\
      <stop stop-color=&quot;#152247&quot;/><stop offset=&quot;1&quot; stop-color=&quot;#0b162f&quot;/></linearGradient></defs>\
      <rect width=&quot;1200&quot; height=&quot;675&quot; fill=&quot;url(#g)&quot;/>\
      <g fill=&quot;#19e1ff&quot; opacity=&quot;.35&quot;><circle cx=&quot;200&quot; cy=&quot;120&quot; r=&quot;120&quot;/>\
      <circle cx=&quot;980&quot; cy=&quot;560&quot; r=&quot;110&quot;/></g>\
      <text x=&quot;70&quot; y=&quot;380&quot; font-family=&quot;Arial Black&quot; font-size=&quot;110&quot; fill=&quot;#8cf2ff&quot;>KOSMOS.WORM</text>\
      <text x=&quot;70&quot; y=&quot;470&quot; font-family=&quot;Arial&quot; font-size=&quot;36&quot; fill=&quot;#b8d7ff&quot;>Загрузите /assets/cover.png для своей обложки</text></svg>';">
    </figure>
    <div>
      <h1>Яркая аркада про светящихся червей</h1>
      <p>Правый невидимый джойстик — направление, левый круг — ускорение. Боты-планеты, мини-карта, честные столкновения.</p>
      <div class="actions">
        <button id="playWorm" class="btn">Играть в Worm</button>
        <a class="btn" href="https://github.com/" target="_blank" rel="noreferrer">Загрузить обложку</a>
      </div>
    </div>
  </section>

  <section class="card">
    <h3 style="margin-bottom:6px">Как вставить свою картинку на заставку</h3>
    <ol style="opacity:.9;line-height:1.6;margin-left:18px">
      <li>Создай в репозитории папку <b>assets</b> (если её нет).</li>
      <li>Загрузи туда файл с именем <b>cover.png</b> (лучше 1600×900).</li>
      <li>Обнови страницу — картинка появится в блоке выше.</li>
    </ol>
  </section>
</main>

<!-- ===== HUD игры (показывается только во время Worm) ===== -->
<div class="gamebar">
  <div class="score">Счёт: <span id="score">0</span></div>
  <button id="pauseBtn">Пауза / Выход</button>
</div>
<div class="minimap"><canvas id="mini"></canvas></div>
<div class="hud">
  <div id="boostArea"></div>
  <div id="aimArea"></div>
</div>

<!-- Пауза -->
<div id="pauseModal" class="modal">
  <div class="box">
    <h3>Пауза</h3>
    <div class="body">
      <button id="resume" class="btn">Продолжить</button>
      <button id="restart" class="btn">Начать заново</button>
      <button id="exit" class="btn">В меню</button>
    </div>
  </div>
</div>

<script>
/* ========= утилы ========= */
const $=s=>document.querySelector(s);
const on=(e,t,f,o)=>e&&e.addEventListener(t,f,o);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const rand=(a,b)=>a+Math.random()*(b-a);

/* ========= меню / пауза ========= */
on($('#pauseBtn'),'click',()=>{$('#pauseModal').classList.add('show'); cancelAnimationFrame(wRAF);});
on($('#resume'),'click',()=>{$('#pauseModal').classList.remove('show'); if(wRun) wRAF=requestAnimationFrame(wStep);});
on($('#exit'),'click',()=>{$('#pauseModal').classList.remove('show'); stopWorm(false);});
on($('#restart'),'click',()=>{$('#pauseModal').classList.remove('show'); if(wRun){ stopWorm(false); startWorm(); }});

/* ======================================================================
   WORM — только в игре, ничего на заставке не создаём
   ====================================================================== */
let wCanvas=null,wCtx=null,wRAF=null,wRun=false,lastTs=0;
const WCFG={WORLD:3600,SPEED:2.35,BOOST:1.55,TURN:0.12,SEG:8,FOOD_R:4,FOOD_TARGET:160};
const PLANETS=["Марс","Земля","Юпитер","Венера","Сатурн","Нептун","Меркурий","Уран","Плутон","Европа","Ио","Титан","Ганимед","Каллисто","Тритон"];
const COLORS=['#6bf2ff','#7eff6b','#ff6be6','#ffaa6b','#7aa3ff','#ffd86b'];
const FOOD_TYPES=['dot','bomb','flower','rainbow','rad','mass'];
const FOOD_PROB={dot:0.90,bomb:0.02,flower:0.03,rainbow:0.03,rad:0.02};
const rndColor=()=>COLORS[Math.floor(Math.random()*COLORS.length)];
const wTouch={on:false,sx:0,sy:0,ex:0,ey:0};
let wSnakes=[],wFoods=[],wMe=null,wScore=0,wBoost=false,chewUntil=0,eatGlowUntil=0;
const wCam={x:0,y:0};
const mini=$('#mini'), miniCtx=mini.getContext('2d');

function wHead(s){return s.segs[0];}
function wDist2(a,b){const dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy;}
function wLerpAng(a,b,t){let d=((b-a+Math.PI*3)%(Math.PI*2))-Math.PI;return a+d*t;}

function wNewSnake(x,y,isP=false,name='bot',color='#6bf2ff'){
  const dir=Math.random()*Math.PI*2;
  const s={isP,alive:true,name,color,dir,segs:[],grow:0,baseR:6,fatUntil:0,radUntil:0,radShrink:0};
  const L=24+Math.floor(Math.random()*10);
  for(let i=0;i<L;i++) s.segs.push({x:x-i*WCFG.SEG*Math.cos(dir),y:y-i*WCFG.SEG*Math.sin(dir)});
  return s;
}
function wMakeFood(){const r=Math.random();let type='dot',acc=0;for(const t of FOOD_TYPES){acc+=FOOD_PROB[t];if(r<=acc){type=t;break;}}return {x:rand(40,WCFG.WORLD-40),y:rand(40,WCFG.WORLD-40),type,sz:1};}
function wEnsureFood(){ while(wFoods.length<WCFG.FOOD_TARGET) wFoods.push(wMakeFood()); }

function wResize(){ if(!wCanvas) return; wCanvas.width=innerWidth; wCanvas.height=innerHeight; mini.width=110; mini.height=110; }
function wCamUpdate(){ const h=wHead(wMe); wCam.x=clamp(h.x-wCanvas.width/2,0,WCFG.WORLD-wCanvas.width); wCam.y=clamp(h.y-wCanvas.height/2,0,WCFG.WORLD-wCanvas.height); }
function dropMeat(s){ for(let i=0;i<s.segs.length;i+=2){ const p=s.segs[i]; wFoods.push({x:p.x,y:p.y,type:'mass',sz:1}); } }

function startWorm(){
  if(wRun) return;
  document.body.classList.add('playing');
  // создаём канвас ТОЛЬКО сейчас
  wCanvas=document.createElement('canvas');
  wCanvas.style.position='fixed'; wCanvas.style.inset='0'; wCanvas.style.zIndex='3'; wCanvas.style.touchAction='none';
  document.body.appendChild(wCanvas);
  wCtx=wCanvas.getContext('2d');
  wRun=true; wResize(); addEventListener('resize',wResize);

  // мир
  wSnakes=[]; wFoods=[]; wScore=0; $('#score').textContent=0;
  const meName=($('#playerName').value||'Kosmos').slice(0,16);
  wMe=wNewSnake(rand(1000,1400),rand(1000,1400),true,meName,'#6bf2ff'); wSnakes.push(wMe);
  const want=clamp(parseInt($('#botCount').value||12,10),0,40);
  while(wSnakes.filter(s=>!s.isP).length<want){
    wSnakes.push(wNewSnake(rand(200,WCFG.WORLD-200),rand(200,WCFG.WORLD-200),false,PLANETS[Math.floor(Math.random()*PLANETS.length)], rndColor()));
  }
  for(let i=0;i<140;i++) wFoods.push(wMakeFood());

  // управление (право — aim, лево — boost)
  bindAim(); bindBoost();

  lastTs=0; wRAF=requestAnimationFrame(wStep);
}
function stopWorm(save=false){
  if(!wRun) return;
  wRun=false; cancelAnimationFrame(wRAF); removeEventListener('resize',wResize);
  wCanvas?.remove(); wCanvas=null; wCtx=null;
  document.body.classList.remove('playing');
}

function wUpdate(ts){
  if(!lastTs) lastTs=ts; const dt=Math.min(32,ts-lastTs); lastTs=ts;
  if(wTouch.on){ const a=Math.atan2(wTouch.ey-wTouch.sy,wTouch.ex-wTouch.sx); if(isFinite(a)) wMe.dir=wLerpAng(wMe.dir,a,WCFG.TURN*(dt/16)*1.5); }

  // движение/еда
  for(const s of wSnakes){
    if(!s.alive) continue;
    if(!s.isP){ s.dir=wLerpAng(s.dir,s.dir+rand(-0.3,0.3),0.05*(dt/16)); }
    const now=performance.now();
    const targetR=now<s.fatUntil?s.baseR*1.8:s.baseR; const radCut=now<s.radUntil?(0.5+s.radShrink*0.5):1;
    s.baseR=Math.max(5,Math.min(28,s.baseR)); s.r=Math.max(4,Math.min(32,targetR*radCut));
    const sp=(s.isP&&wBoost?WCFG.SPEED*WCFG.BOOST:WCFG.SPEED)*(dt/16);
    const nx=wHead(s).x+Math.cos(s.dir)*sp, ny=wHead(s).y+Math.sin(s.dir)*sp;
    s.segs.unshift({x:nx,y:ny}); if(s.grow>0)s.grow--; else if(s.segs.length>26)s.segs.pop();

    for(let i=wFoods.length-1;i>=0;i--){
      const f=wFoods[i], rr=(s.r+(f.type==='mass'?6:WCFG.FOOD_R)+4);
      if(wDist2(wHead(s),f)<rr*rr){
        wFoods.splice(i,1);
        if(f.type==='dot'){ s.grow+=5; if(s.isP){ wScore++; $('#score').textContent=wScore; } }
        else if(f.type==='bomb'){ s.alive=false; if(s.isP){ navigator.vibrate?.(180); stopWorm(true); return; } }
        else if(f.type==='flower'){ s.fatUntil=now+15000; }
        else if(f.type==='rainbow'){ s.color=rndColor(); }
        else if(f.type==='rad'){ s.radUntil=now+10000; s.radShrink=0; }
        else if(f.type==='mass'){ s.baseR=Math.min(32,s.baseR+0.45*f.sz); s.grow+=Math.ceil(4*f.sz); if(s.isP){ wScore+=3*f.sz|0; $('#score').textContent=wScore; chewUntil=now+500; eatGlowUntil=now+800; } }
      }
    }
    const h=wHead(s); if(h.x<0)h.x+=WCFG.WORLD; if(h.x>WCFG.WORLD)h.x-=WCFG.WORLD; if(h.y<0)h.y+=WCFG.WORLD; if(h.y>WCFG.WORLD)h.y-=WCFG.WORLD;
  }

  // столкновения: виноват тот, чья ГОЛОВА врезалась
  for(const attacker of wSnakes){
    if(!attacker.alive) continue; const H=attacker.segs[0];
    for(const victim of wSnakes){
      if(attacker===victim || !victim.alive) continue;
      const R2=(attacker.r+victim.r*0.85)**2;
      for(let k=2;k<victim.segs.length;k++){
        if(wDist2(H,victim.segs[k])<=R2){
          if(attacker.isP){ attacker.alive=false; navigator.vibrate?.([80,50,120]); stopWorm(true); return; }
          if(victim.isP){ attacker.alive=false; dropMeat(attacker); const now=performance.now(); eatGlowUntil=now+900; chewUntil=now+600; wMe.baseR=Math.min(32,wMe.baseR+0.6); wMe.grow+=8; wScore+=5; $('#score').textContent=wScore; }
          else { attacker.alive=false; dropMeat(attacker); }
          break;
        }
      }
    }
  }
  wSnakes=wSnakes.filter(s=>s.alive);
  while(wSnakes.filter(s=>!s.isP).length<clamp(parseInt($('#botCount').value||12,10),0,40)){
    wSnakes.push(wNewSnake(rand(200,WCFG.WORLD-200),rand(200,WCFG.WORLD-200),false,PLANETS[Math.floor(Math.random()*PLANETS.length)], rndColor()));
  }
  wEnsureFood();
}

function drawStripedCircle(ctx,x,y,r,color){
  const lg=ctx.createLinearGradient(x-r,y-r,x+r,y+r);
  lg.addColorStop(0,color); lg.addColorStop(.5,'#ffffff22'); lg.addColorStop(1,color);
  ctx.fillStyle=lg; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
}
function drawSnake(s){
  const ctx=wCtx, now=performance.now();
  ctx.save(); ctx.globalCompositeOperation='lighter';
  const glow = (s.isP && now<eatGlowUntil) ? '#6eff7a' : (now<s.radUntil? '#8cff7a' : s.color);
  ctx.shadowColor=glow; ctx.shadowBlur=22;
  for(let i=0;i<s.segs.length;i+=2){ const p=s.segs[i]; ctx.beginPath(); ctx.arc(p.x,p.y,s.r,0,Math.PI*2); ctx.fillStyle=s.color; ctx.fill(); }
  ctx.restore();
  for(let i=0;i<s.segs.length;i++){ const p=s.segs[i]; drawStripedCircle(ctx,p.x,p.y,s.r,s.color); }
  // голова/глаза по направлению
  const h=wHead(s), dpx=Math.cos(s.dir), dpy=Math.sin(s.dir), nx=-dpy, ny=dpx, off=s.r*.62;
  if(s.isP && now<chewUntil){ ctx.save(); ctx.translate(h.x,h.y); ctx.rotate(s.dir); ctx.beginPath(); ctx.arc(0,0,s.r*0.85,Math.PI*0.15,-Math.PI*0.15,false); ctx.lineWidth=3; ctx.strokeStyle='#111'; ctx.stroke(); ctx.restore(); }
  const eye=s.r*.46, pupil=eye*.45, ex=h.x+nx*off, ey=h.y+ny*off, ex2=h.x-nx*off, ey2=h.y-ny*off;
  ctx.beginPath(); ctx.fillStyle='#fff';
  ctx.arc(ex+dpx*.6,ey+dpy*.6,eye,0,Math.PI*2); ctx.arc(ex2+dpx*.6,ey2+dpy*.6,eye,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.fillStyle='#111';
  ctx.arc(ex+dpx*1.0,ey+dpy*1.0,pupil,0,Math.PI*2); ctx.arc(ex2+dpx*1.0,ey2+dpy*1.0,pupil,0,Math.PI*2); ctx.fill();
  // ник
  ctx.font='700 13px system-ui,Arial'; ctx.textAlign='center'; ctx.textBaseline='bottom';
  ctx.fillStyle='#e7f7ff'; ctx.strokeStyle='#08121f'; ctx.lineWidth=2;
  const nxp=Math.round(h.x)+0.5, nyp=Math.round(h.y-s.r*1.7)+0.5; ctx.strokeText(s.name,nxp,nyp); ctx.fillText(s.name,nxp,nyp);
}

function drawMinimap(){
  const r=mini.width/2, scale=r*0.9/WCFG.WORLD, ctx=miniCtx;
  ctx.clearRect(0,0,mini.width,mini.height);
  ctx.save(); ctx.translate(r,r); ctx.beginPath(); ctx.arc(0,0,r-1,0,Math.PI*2); ctx.clip();
  ctx.fillStyle='#0b1a2c'; ctx.fillRect(-r,-r,mini.width,mini.height);
  for(const f of wFoods){ if(f.type==='dot') continue; const x=(f.x-WCFG.WORLD/2)*scale, y=(f.y-WCFG.WORLD/2)*scale; ctx.fillStyle='#57e1ff'; ctx.fillRect(x-1,y-1,2,2); }
  const hx=(wHead(wMe).x-WCFG.WORLD/2)*scale, hy=(wHead(wMe).y-WCFG.WORLD/2)*scale; ctx.beginPath(); ctx.arc(hx,hy,3,0,Math.PI*2); ctx.fillStyle='#39f3ff'; ctx.fill();
  ctx.restore();
}

function wDraw(){
  const ctx=wCtx; ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,wCanvas.width,wCanvas.height);
  ctx.translate(-wCam.x,-wCam.y);
  ctx.fillStyle='#06101a'; ctx.fillRect(wCam.x,wCam.y,wCanvas.width,wCanvas.height);
  for(const f of wFoods){
    if(f.type==='dot'){ ctx.beginPath(); ctx.arc(f.x,f.y,WCFG.FOOD_R,0,Math.PI*2); ctx.fillStyle='#00ffd5'; ctx.shadowBlur=12; ctx.shadowColor='#00ffd5'; ctx.fill(); ctx.shadowBlur=0; }
    else if(f.type==='mass'){ ctx.beginPath(); ctx.arc(f.x,f.y,6,0,Math.PI*2); ctx.fillStyle='#ffd36b'; ctx.shadowBlur=14; ctx.shadowColor='#ffd36b'; ctx.fill(); ctx.shadowBlur=0; }
    else { ctx.save(); ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font='20px "Apple Color Emoji","Segoe UI Emoji",system-ui'; const map={bomb:'💣',flower:'🏵️',rainbow:'🌈',rad:'☢️'}; ctx.fillText(map[f.type]||'❓',f.x,f.y+1); ctx.restore(); }
  }
  for(const s of wSnakes) drawSnake(s);
  drawMinimap();
}

function wStep(ts){ if(!wRun) return; wUpdate(ts); wCamUpdate(); wDraw(); wRAF=requestAnimationFrame(wStep); }

/* управление: правый aim + левый boost (только в игре) */
const aimEl=$('#aimArea'), boostEl=$('#boostArea'); let aimId=null, boostId=null;
function bindAim(){ on(aimEl,'touchstart',aimStart,{passive:false}); on(aimEl,'touchmove',aimMove,{passive:true}); on(aimEl,'touchend',aimEnd,{passive:true}); on(aimEl,'mousedown',aimStart); on(aimEl,'mousemove',aimMove); on(aimEl,'mouseup',aimEnd); }
function bindBoost(){ on(boostEl,'touchstart',boostStart,{passive:false}); on(boostEl,'touchend',boostEnd,{passive:true}); on(boostEl,'mousedown',boostStart); on(boostEl,'mouseup',boostEnd); }
function aimStart(e){const t=e.changedTouches?e.changedTouches[0]:e;if(t.clientX<innerWidth*0.45)return;aimId=t.identifier??'mouse';wTouch.on=true;wTouch.sx=wTouch.ex=t.clientX;wTouch.sy=wTouch.ey=t.clientY;e.preventDefault?.();}
function aimMove(e){for(const t of (e.changedTouches||[e])){const id=t.identifier??'mouse';if(id!==aimId)continue;wTouch.ex=t.clientX;wTouch.ey=t.clientY;}}
function aimEnd(e){for(const t of (e.changedTouches||[e])){const id=t.identifier??'mouse';if(id===aimId){wTouch.on=false;aimId=null;}}}
function boostStart(e){const t=e.changedTouches?e.changedTouches[0]:e;boostId=t.identifier??'mouse';wBoost=true;e.preventDefault?.();}
function boostEnd(e){for(const t of (e.changedTouches||[e])){const id=t.identifier??'mouse';if(id===boostId){wBoost=false;boostId=null;}}}

/* запуск */
on($('#playWorm'),'click',startWorm);
</script>
</body>
</html>