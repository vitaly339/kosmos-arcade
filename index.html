<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KOSMOS.ARCADE ‚Äî Worm & Cat (baseline)</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{background:#0b1020;color:#fff;font-family:system-ui,Arial;overflow:hidden}
.top{position:fixed;left:0;right:0;top:0;display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px 12px;background:#0006;border-bottom:1px solid #ffffff18;z-index:5}
.brand{font-weight:700}
.row{display:flex;gap:8px;align-items:center}
.input,.btn,.chip{padding:8px 10px;border-radius:8px;border:1px solid #ffffff22;background:#ffffff10;color:#fff}
.btn{cursor:pointer}
.main{position:fixed;inset:56px 0 0 0;display:flex;align-items:center;justify-content:center}
.menu{display:grid;gap:12px;max-width:520px;width:92%}
.card{border:1px solid #ffffff22;border-radius:12px;padding:14px;background:#0f1630}
.card h3{margin-bottom:6px}
.footer{position:fixed;left:0;right:0;bottom:0;text-align:center;color:#9aa1b6;font-size:12px;padding:6px 0;border-top:1px solid #ffffff18;background:#0006;z-index:5}
.hud{position:fixed;inset:0;pointer-events:none;display:none;z-index:6}
.hud.show{display:block}
.hud .bigbtn{position:absolute;bottom:14px;width:80px;height:80px;border-radius:999px;border:1px solid #ffffff22;background:#ffffff14;color:#fff;font-size:22px;pointer-events:auto}
#boost{right:14px} #left{left:14px} #right{left:112px}
.hide-when-playing{display:block}
.playing .hide-when-playing{display:none}
</style>
</head>
<body>
<header class="top">
  <div class="brand">KOSMOS.ARCADE</div>
  <div class="row">
    <span>–ò–º—è</span><input id="playerName" class="input" value="Kosmos" maxlength="16" style="width:120px">
    <span>–ë–æ—Ç–æ–≤</span><input id="botCount" class="input" type="number" min="0" max="20" value="6" style="width:64px">
    <div id="score" class="chip">0</div>
    <button id="toMenu" class="btn">–í –º–µ–Ω—é</button>
  </div>
</header>

<main class="main hide-when-playing">
  <div class="menu">
    <div class="card">
      <h3>üêç Worm</h3>
      <p>–ë–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–∞, –∫–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç, 6 –±–æ—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–æ–º (–Ω–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫).</p>
      <button id="playWorm" class="btn">–ò–≥—Ä–∞—Ç—å</button>
    </div>
    <div class="card">
      <h3>üê± Super Cat (Jump)</h3>
      <p>–ü–æ–ª–Ω—ã–π –∫–æ—Ç, –∞–≤—Ç–æ–ø—Ä—ã–∂–∫–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–≤–∏–¥–∏–º—ã–º –¥–∂–æ–π—Å—Ç–∏–∫–æ–º (—Å–≤–∞–π–ø –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ).</p>
      <button id="playCat" class="btn">–ò–≥—Ä–∞—Ç—å</button>
    </div>
  </div>
</main>

<footer class="footer hide-when-playing">baseline —Å–±–æ—Ä–∫–∞ ‚Äî —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–æ</footer>

<!-- HUD –¥–ª—è –∏–≥—Ä -->
<div id="hud" class="hud">
  <button id="left"  class="bigbtn">‚óÄ</button>
  <button id="right" class="bigbtn">‚ñ∂</button>
  <button id="boost" class="bigbtn">‚ö°</button>
</div>

<script>
/* ===== –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã ===== */
const $ = s => document.querySelector(s);
const on = (el,ev,fn,opt)=>el&&el.addEventListener(ev,fn,opt);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const rand =(a,b)=>a+Math.random()*(b-a);

/* ===== –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ ===== */
on($('#toMenu'),'click',()=>{ stopWorm(false); stopCat(false); document.body.classList.remove('playing'); $('#hud').classList.remove('show'); });

/* =======================================================================
   WORM ‚Äî –ø—Ä–æ—Å—Ç–æ–π, –Ω–∞–¥—ë–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
   ======================================================================= */
let wCanvas=null,wCtx=null,wRAF=null,wRun=false;
const WCFG={WORLD:2600,SPEED:2.3,TURN:0.1,SEG:8,R:12,FOOD:4};
const wTouch={on:false,sx:0,sy:0,ex:0,ey:0};
let wSnakes=[], wFoods=[], wMe=null, wScore=0, wBoost=false;
const wCam={x:0,y:0,zoom:1};

function wHead(s){return s.segs[0];}
function wDist2(a,b){const dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy;}
function wLerpAng(a,b,t){let d=((b-a+Math.PI*3)%(Math.PI*2))-Math.PI;return a+d*t;}

function wNewSnake(x,y,isP=false,name='bot',color='#6bf2ff'){
  const dir=Math.random()*Math.PI*2, s={isP,alive:true,name,color,dir,r:WCFG.R,segs:[],grow:0};
  for(let i=0;i<28;i++) s.segs.push({x:x-i*WCFG.SEG*Math.cos(dir),y:y-i*WCFG.SEG*Math.sin(dir)});
  return s;
}

function wSpawn(){
  wSnakes=[]; wFoods=[];
  const meName=($('#playerName').value||'Kosmos').slice(0,16);
  wMe = wNewSnake(rand(600,1000),rand(600,1000),true,meName,'#6bf2ff');
  wSnakes.push(wMe);
  const planets=["–ú–∞—Ä—Å","–ó–µ–º–ª—è","–Æ–ø–∏—Ç–µ—Ä","–í–µ–Ω–µ—Ä–∞","–°–∞—Ç—É—Ä–Ω","–ù–µ–ø—Ç—É–Ω","–£—Ä–∞–Ω"];
  const n = clamp(parseInt($('#botCount').value||6,10),0,20);
  for(let i=0;i<n;i++){ wSnakes.push(wNewSnake(rand(200,WCFG.WORLD-200),rand(200,WCFG.WORLD-200),false, planets[i%planets.length], ['#7eff6b','#ffaa6b','#7aa3ff','#ffd86b'][i%4])); }
  for(let i=0;i<120;i++) wFoods.push({x:rand(40,WCFG.WORLD-40),y:rand(40,WCFG.WORLD-40)});
  wScore=0; $('#score').textContent=0;
}

function wResize(){ wCanvas.width=innerWidth; wCanvas.height=innerHeight; }
function wUpdate(){
  // —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º
  if(wTouch.on){
    const a=Math.atan2(wTouch.ey-wTouch.sy, wTouch.ex-wTouch.sx);
    if(isFinite(a)) wMe.dir = wLerpAng(wMe.dir, a, WCFG.TURN*2);
  }
  const v = wBoost? WCFG.SPEED*1.5 : WCFG.SPEED;

  // –∞–ø–¥–µ–π—Ç –≤—Å–µ—Ö
  for(const s of wSnakes){
    if(!s.alive) continue;
    if(!s.isP){ s.dir += rand(-WCFG.TURN*0.4, WCFG.TURN*0.4); }
    const nx=wHead(s).x+Math.cos(s.dir)*v, ny=wHead(s).y+Math.sin(s.dir)*v;
    s.segs.unshift({x:nx,y:ny});
    if(s.segs.length>28+s.grow) s.segs.pop();

    // –µ–¥–∞
    for(let i=wFoods.length-1;i>=0;i--){
      const f=wFoods[i];
      if(wDist2(wHead(s),f)<(s.r+WCFG.FOOD)**2){
        wFoods.splice(i,1); s.grow+=4;
        if(s.isP){ wScore++; $('#score').textContent=wScore; }
      }
    }
    // –∫—Ä–∞—è –º–∏—Ä–∞
    const h=wHead(s); if(h.x<0)h.x+=WCFG.WORLD; if(h.x>WCFG.WORLD)h.x-=WCFG.WORLD; if(h.y<0)h.y+=WCFG.WORLD; if(h.y>WCFG.WORLD)h.y-=WCFG.WORLD;
  }

  // –ø—Ä–æ—Å—Ç–∞—è –∫–æ–ª–ª–∏–∑–∏—è –≥–æ–ª–æ–≤–∞/—Ç–µ–ª–æ
  for(const a of wSnakes){
    if(!a.alive) continue;
    for(const b of wSnakes){
      if(a===b || !b.alive) continue;
      const R2=(a.r+b.r*0.9)**2, H=wHead(a);
      for(const seg of b.segs){
        if(wDist2(H,seg)<=R2){ a.alive=false; if(a.isP) stopWorm(true); break; }
      }
    }
  }
  wSnakes = wSnakes.filter(s=>s.alive);
}

function wCamUpdate(){
  if(!wMe) return;
  wCam.x = wHead(wMe).x - wCanvas.width/2;
  wCam.y = wHead(wMe).y - wCanvas.height/2;
  wCam.x = clamp(wCam.x, 0, WCFG.WORLD-wCanvas.width);
  wCam.y = clamp(wCam.y, 0, WCFG.WORLD-wCanvas.height);
}

function wDraw(){
  const ctx=wCtx;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,wCanvas.width,wCanvas.height);
  ctx.translate(-wCam.x,-wCam.y);
  ctx.fillStyle='#06101a'; ctx.fillRect(wCam.x,wCam.y,wCanvas.width,wCanvas.height);

  // –µ–¥–∞
  ctx.fillStyle='#00ffd5';
  for(const f of wFoods){ ctx.beginPath(); ctx.arc(f.x,f.y,WCFG.FOOD,0,Math.PI*2); ctx.fill(); }

  // –∑–º–µ–∏
  for(const s of wSnakes){
    ctx.lineWidth=s.r*2; ctx.lineCap='round';
    ctx.beginPath(); ctx.moveTo(s.segs[0].x,s.segs[0].y);
    for(const p of s.segs) ctx.lineTo(p.x,p.y);
    ctx.strokeStyle=s.color; ctx.stroke();

    // –≥–ª–∞–∑–∞
    const h=wHead(s), dpx=Math.cos(s.dir), dpy=Math.sin(s.dir), nx=-dpy, ny=dpx, off=s.r*.6, eye=s.r*.45;
    ctx.beginPath(); ctx.fillStyle='#fff';
    ctx.arc(h.x+nx*off+dpx*.6, h.y+ny*off+dpy*.6, eye, 0, Math.PI*2);
    ctx.arc(h.x-nx*off+dpx*.6, h.y-ny*off+dpy*.6, eye, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.fillStyle='#111';
    ctx.arc(h.x+nx*off+dpx*1.0, h.y+ny*off+dpy*1.0, eye*.45, 0, Math.PI*2);
    ctx.arc(h.x-nx*off+dpx*1.0, h.y-ny*off+dpy*1.0, eye*.45, 0, Math.PI*2); ctx.fill();

    // –Ω–∏–∫ (—á—ë—Ç–∫–∏–π)
    ctx.font='600 13px system-ui,Arial'; ctx.textAlign='center'; ctx.textBaseline='bottom';
    ctx.fillStyle='#e7f7ff'; ctx.strokeStyle='#08121f'; ctx.lineWidth=2;
    const nxp=Math.round(h.x)+0.5, nyp=Math.round(h.y-s.r*1.7)+0.5;
    ctx.strokeText(s.name,nxp,nyp); ctx.fillText(s.name,nxp,nyp);
  }
}

function wStep(){
  if(!wRun) return;
  wUpdate(); wCamUpdate(); wDraw();
  wRAF = requestAnimationFrame(wStep);
}

function startWorm(){
  if(wRun) return;
  document.body.classList.add('playing'); $('#hud').classList.add('show');
  wCanvas=document.createElement('canvas'); wCanvas.style.position='fixed'; wCanvas.style.inset='0'; wCanvas.style.zIndex='3'; wCanvas.style.touchAction='none';
  document.body.appendChild(wCanvas); wCtx=wCanvas.getContext('2d'); wRun=true; wResize(); addEventListener('resize',wResize);
  wSpawn(); wRAF=requestAnimationFrame(wStep);
}
function stopWorm(save=false){
  if(!wRun) return;
  wRun=false; cancelAnimationFrame(wRAF); removeEventListener('resize',wResize);
  wCanvas.remove(); document.body.classList.remove('playing'); $('#hud').classList.remove('show');
}

on($('#playWorm'),'click',startWorm);

/* —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ worm */
function wJoyStart(e){const t=e.touches?e.touches[0]:e; wTouch.on=true; wTouch.sx=wTouch.ex=t.clientX; wTouch.sy=wTouch.ey=t.clientY;}
function wJoyMove (e){if(!wTouch.on)return; const t=e.touches?e.touches[0]:e; wTouch.ex=t.clientX; wTouch.ey=t.clientY;}
function wJoyEnd  (){wTouch.on=false;}
on(document,'touchstart',wJoyStart,{passive:true}); on(document,'touchmove',wJoyMove,{passive:true}); on(document,'touchend',wJoyEnd,{passive:true});
on(document,'mousedown',wJoyStart); on(document,'mousemove',wJoyMove); on(document,'mouseup',wJoyEnd);
on($('#boost'),'touchstart',()=>wBoost=true,{passive:true}); on($('#boost'),'touchend',()=>wBoost=false,{passive:true});
on($('#boost'),'mousedown',()=>wBoost=true); on(window,'mouseup',()=>wBoost=false);

/* =======================================================================
   SUPER CAT ‚Äî –ø—Ä–æ—Å—Ç–æ–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–ø–æ–ª–Ω–æ–µ —Ç–µ–ª–æ + –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
   ======================================================================= */
let cCanvas=null,cCtx=null,cRAF=null,cRun=false;
const cat={x:0,y:0,vx:0,vy:-8,w:36,h:46,face:1};
const cJoy={on:false,sx:0,sy:0,ex:0,ey:0};
let camY=0, cScore=0, plats=[];

function cReset(){
  plats=[]; cScore=0; camY=0;
  cat.x=innerWidth/2; cat.y=0; cat.vx=0; cat.vy=-8; cat.face=1;
  let y=0; for(let i=0;i<28;i++){ plats.push(cMake(rand(40,innerWidth-160), y, cType())); y -= rand(70,110); }
}
function cType(){ const r=Math.random(); if(r<0.2) return 'move'; if(r<0.28) return 'break'; return 'solid'; }
function cMake(x,y,type){ const w = type==='solid'?rand(80,150):rand(90,150); return {x,y,w,type,dir:Math.random()<.5?-1:1,life:1,off:Math.random()*1000}; }
function cEnsure(){
  let topY = plats.length? Math.min(...plats.map(p=>p.y)) : 0;
  while (topY > camY - 1400){ topY -= rand(70,110); plats.push(cMake(rand(30,innerWidth-160), topY, cType())); }
  plats = plats.filter(p=>p.y < camY + innerHeight + 200 && p.life>0);
}

function cJoySet(dx){ const ax = clamp(dx*0.06, -1, 1); cat.vx = clamp(cat.vx+ax, -6, 6); if(Math.abs(ax)>0.01) cat.face=ax>0?1:-1; }
function cInput(){ if(cJoy.on){ cJoySet(cJoy.ex-cJoy.sx); } }
function cPhys(){
  cat.vy += 0.35; cat.x += cat.vx; cat.y += cat.vy; cat.vx *= 0.992;
  if(cat.x<-cat.w)cat.x=innerWidth+cat.w; if(cat.x>innerWidth+cat.w)cat.x=-cat.w;

  for(const p of plats){ if(p.type==='move'){ p.x += p.dir*1.2*Math.sin((performance.now()+p.off)/800); p.x=clamp(p.x,10,innerWidth-p.w-10); } }

  if(cat.vy>0){
    for(const p of plats){
      if(cat.y+cat.h/2>p.y && cat.y+cat.h/2<p.y+14 && cat.x>p.x && cat.x<p.x+p.w){
        if(p.type==='break'){ p.life=0; } else { cat.vy = -10; }
      }
    }
  }
  camY = Math.min(camY, cat.y - innerHeight*0.45);
  cScore = Math.max(cScore, Math.round(-(cat.y-0)));
  $('#score').textContent = cScore;
}

function cDrawCat(){
  const ctx=cCtx, x=cat.x, y=cat.y-camY, f=cat.face, w=cat.w, h=cat.h;
  // —Ö–≤–æ—Å—Ç
  ctx.save(); ctx.translate(x - f*w*0.35, y + h*0.05); ctx.rotate(Math.sin(performance.now()/150)*0.2*f);
  ctx.beginPath(); ctx.ellipse(0,0, w*0.28, h*0.18, 0, 0, Math.PI*2); ctx.fillStyle='#f7c38b'; ctx.fill(); ctx.restore();
  // —Ç–µ–ª–æ
  ctx.beginPath(); if (ctx.roundRect) ctx.roundRect(x - w*0.35, y - h*0.4, w*0.7, h*0.8, 12);
  else ctx.rect(x - w*0.35, y - h*0.4, w*0.7, h*0.8);
  ctx.fillStyle='#ffd9a8'; ctx.fill();
  // –ª–∞–ø—ã
  const step=Math.sin(performance.now()/120)*3; ctx.fillStyle='#ffc891';
  ctx.fillRect(x - w*0.28 + step*f, y + h*0.35, w*0.22, 6);
  ctx.fillRect(x + w*0.06 + step*f,  y + h*0.35, w*0.22, 6);
  // –≥–æ–ª–æ–≤–∞
  ctx.beginPath(); ctx.ellipse(x, y - h*0.55, w*0.42, h*0.33, 0, 0, Math.PI*2); ctx.fillStyle='#ffd9a8'; ctx.fill();
  // —É—à–∫–∏
  ctx.beginPath(); ctx.moveTo(x - w*0.28, y - h*0.76); ctx.lineTo(x - w*0.14, y - h*0.98); ctx.lineTo(x - w*0.02, y - h*0.70); ctx.closePath(); ctx.fillStyle='#ffb77a'; ctx.fill();
  ctx.beginPath(); ctx.moveTo(x + w*0.28, y - h*0.76); ctx.lineTo(x + w*0.14, y - h*0.98); ctx.lineTo(x + w*0.02, y - h*0.70); ctx.closePath(); ctx.fillStyle='#ffb77a'; ctx.fill();
  // –ª–∏—Ü–æ
  const ex=x+f*w*0.10; ctx.beginPath(); ctx.fillStyle='#222';
  ctx.arc(ex - w*0.12, y - h*0.58, 3.6, 0, Math.PI*2);
  ctx.arc(ex + w*0.12, y - h*0.58, 3.6, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x, y - h*0.50, 2.4, 0, Math.PI*2); ctx.fillStyle='#e27b7b'; ctx.fill();
}

function cDraw(){
  const ctx=cCtx; ctx.clearRect(0,0,cCanvas.width,cCanvas.height);
  // —Ñ–æ–Ω
  const g=ctx.createLinearGradient(0,0,0,innerHeight); g.addColorStop(0,'#0c1430'); g.addColorStop(1,'#091224');
  ctx.fillStyle=g; ctx.fillRect(0,0,cCanvas.width,cCanvas.height);
  // –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  for(const p of plats){ const y=p.y-camY; if(y<-40||y>innerHeight+40) continue;
    ctx.fillStyle = p.type==='solid' ? '#21d1a3' : (p.type==='move' ? '#2db3ff' : '#ff7676');
    ctx.fillRect(p.x,y,p.w,10);
  }
  cDrawCat();
}

function cStep(){ if(!cRun) return; cInput(); cPhys(); cEnsure(); cDraw(); cRAF=requestAnimationFrame(cStep); }
function cResize(){ cCanvas.width=innerWidth; cCanvas.height=innerHeight; cEnsure(); }

function startCat(){
  if(cRun) return;
  document.body.classList.add('playing'); $('#hud').classList.add('show');
  cCanvas=document.createElement('canvas'); cCanvas.style.position='fixed'; cCanvas.style.inset='0'; cCanvas.style.zIndex='3'; cCanvas.style.touchAction='none';
  document.body.appendChild(cCanvas); cCtx=cCanvas.getContext('2d'); addEventListener('resize',cResize); cResize(); cReset(); bindCatJoy();
  cRun=true; cRAF=requestAnimationFrame(cStep);
}
function stopCat(save=false){
  if(!cRun) return;
  cRun=false; cancelAnimationFrame(cRAF); removeEventListener('resize',cResize);
  cCanvas.remove(); document.body.classList.remove('playing'); $('#hud').classList.remove('show');
}

/* —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ cat ‚Äî –Ω–µ–≤–∏–¥–∏–º—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ + –∫–Ω–æ–ø–∫–∏ */
function cJoyStart(e){const t=e.touches?e.touches[0]:e; cJoy.on=true; cJoy.sx=cJoy.ex=t.clientX; cJoy.sy=cJoy.ey=t.clientY;}
function cJoyMove (e){if(!cJoy.on)return; const t=e.touches?e.touches[0]:e; cJoy.ex=t.clientX; cJoy.ey=t.clientY;}
function cJoyEnd  (){cJoy.on=false;}
function bindCatJoy(){
  on(document,'touchstart',cJoyStart,{passive:true}); on(document,'touchmove',cJoyMove,{passive:true}); on(document,'touchend',cJoyEnd,{passive:true});
  on(document,'mousedown',cJoyStart); on(document,'mousemove',cJoyMove); on(document,'mouseup',cJoyEnd);
  on($('#left'),'touchstart',()=>{cJoy.on=true;cJoy.sx=innerWidth*0.25;cJoy.ex=cJoy.sx-60;},{passive:true});
  on($('#left'),'touchend',()=>{cJoy.on=false;},{passive:true});
  on($('#right'),'touchstart',()=>{cJoy.on=true;cJoy.sx=innerWidth*0.75;cJoy.ex=cJoy.sx+60;},{passive:true});
  on($('#right'),'touchend',()=>{cJoy.on=false;},{passive:true});
  on($('#left'),'mousedown',()=>{cJoy.on=true;cJoy.sx=innerWidth*0.25;cJoy.ex=cJoy.sx-60;});
  on($('#right'),'mousedown',()=>{cJoy.on=true;cJoy.sx=innerWidth*0.75;cJoy.ex=cJoy.sx+60;});
  on(window,'mouseup',()=>{cJoy.on=false;});
}

on($('#playCat'),'click',startCat);
</script>
</body>
</html>